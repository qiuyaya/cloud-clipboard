# Cloud Clipboard 调试日志使用指南

Cloud Clipboard 提供了完整的调试日志系统，帮助开发者和用户诊断问题。系统分为前端调试和后端日志两部分。

## 🔧 前端调试日志

### 启用调试模式

在浏览器中打开 Cloud Clipboard 应用，然后打开开发者工具（F12），在控制台中输入以下命令：

```javascript
// 启用调试模式
cloudClipboardDebug.enable();
```

启用后，您将看到类似以下的帮助信息：

```
🚀 Cloud Clipboard Debug Mode: ENABLED
🚀 Cloud Clipboard Debug Controls:
  cloudClipboardDebug.enable()     - Enable debug logging
  cloudClipboardDebug.disable()    - Disable debug logging
  cloudClipboardDebug.setLevel(level) - Set log level (info|warn|error|debug)
  cloudClipboardDebug.getConfig()  - Get current config
  cloudClipboardDebug.clear()      - Clear all debug settings
```

### 设置日志级别

调试系统支持四个日志级别，从低到高分别是：

```javascript
// 显示所有日志（包括详细的连接、消息传输信息）
cloudClipboardDebug.setLevel("debug");

// 显示一般信息、警告和错误（默认级别）
cloudClipboardDebug.setLevel("info");

// 只显示警告和错误
cloudClipboardDebug.setLevel("warn");

// 只显示错误信息
cloudClipboardDebug.setLevel("error");
```

### 查看当前配置

```javascript
// 查看当前调试配置
cloudClipboardDebug.getConfig();
// 输出示例: { enabled: true, level: "debug" }
```

### 关闭调试模式

```javascript
// 关闭调试模式
cloudClipboardDebug.disable();
```

### 清除所有设置

```javascript
// 清除所有调试设置并重置为默认状态
cloudClipboardDebug.clear();
```

## 📊 前端日志内容说明

启用调试模式后，您可以看到以下类型的日志信息：

### 连接相关日志

- **Socket连接状态**: 连接建立、断开、重连等
- **房间加入流程**: 用户加入房间的详细步骤
- **自动重连**: 页面刷新后的自动重连过程

### 消息传输日志

- **WebSocket事件**: 发送和接收的所有WebSocket事件
- **消息处理**: 文本消息和文件消息的处理过程
- **用户状态**: 用户加入、离开房间的事件

### 错误诊断日志

- **连接错误**: 网络连接失败的详细信息
- **上传错误**: 文件上传失败的原因
- **数据处理错误**: 本地存储、数据解析等错误

## 🖥️ 后端日志配置

### 环境变量配置

后端日志通过环境变量进行配置。在启动服务器前设置以下变量：

```bash
# 日志级别配置
export LOG_LEVEL=DEBUG     # 显示所有日志（包括详细调试信息）
export LOG_LEVEL=INFO      # 显示信息、警告、错误（默认）
export LOG_LEVEL=WARN      # 只显示警告和错误
export LOG_LEVEL=ERROR     # 只显示错误
export LOG_LEVEL=SILENT    # 不显示任何日志

# 日志格式配置
export LOG_COLORS=false        # 禁用彩色输出
export LOG_TIMESTAMPS=false    # 禁用时间戳
export LOG_CONTEXT=false       # 禁用上下文标签
```

### 启动服务器

配置好环境变量后，重新启动服务器：

```bash
# 开发模式
bun run server:dev

# 或者同时启动前端和后端
bun run dev
```

## 📝 后端日志内容说明

后端日志包含以下信息：

### 服务器状态

- **启动信息**: 服务器启动端口、环境配置
- **连接管理**: 客户端连接、断开事件
- **优雅关闭**: 服务器关闭过程

### WebSocket通信

- **房间管理**: 用户加入、离开房间
- **消息处理**: 消息验证、转发过程
- **连接状态**: Socket连接的详细状态

### 错误和异常

- **验证错误**: 数据格式验证失败
- **系统错误**: 内部服务器错误
- **连接异常**: 网络连接问题

## 🎯 实际使用场景

### 场景1：连接问题诊断

如果无法连接到服务器：

1. 启用前端调试：`cloudClipboardDebug.enable()`
2. 设置详细级别：`cloudClipboardDebug.setLevel("debug")`
3. 尝试连接，观察控制台输出
4. 检查服务器日志（设置 `LOG_LEVEL=DEBUG`）

### 场景2：消息传输问题

如果消息发送失败：

1. 启用调试模式查看WebSocket事件
2. 观察消息发送和接收的日志
3. 检查错误信息和重连机制

### 场景3：文件上传问题

如果文件上传失败：

1. 查看前端文件上传错误日志
2. 检查后端文件处理日志
3. 验证网络连接和文件大小限制

## 🔒 隐私说明

- 调试日志会记录用户操作和系统状态
- 不会记录消息内容的具体文本
- 文件信息只记录元数据（文件名、大小）
- 密码和敏感信息已脱敏处理

## 💡 提示和最佳实践

1. **生产环境**: 在生产环境中请关闭详细的调试日志
2. **性能影响**: DEBUG级别会产生大量日志，可能影响性能
3. **日志持久化**: 前端调试设置会保存到本地存储
4. **问题反馈**: 遇到问题时，可以复制相关日志信息进行反馈

## 🚨 常见问题

**Q: 调试模式会影响应用性能吗？**
A: DEBUG级别会产生大量日志输出，建议只在需要诊断问题时使用。

**Q: 调试设置会在页面刷新后消失吗？**
A: 不会，前端调试设置会保存到localStorage中，页面刷新后仍然有效。

**Q: 如何在Docker环境中设置日志级别？**
A: 在docker-compose.yml中设置环境变量，或者在Dockerfile中使用ENV指令。

**Q: 日志文件会占用大量磁盘空间吗？**
A: 系统使用控制台输出，不会自动保存到文件。如需保存可以重定向输出。
